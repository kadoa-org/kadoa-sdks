# Data Validation

Learn how to validate extracted data programmatically using the Kadoa SDK. This guide covers validation workflows, real-time monitoring, and automated rule management.

For a complete overview of data validation concepts and visual interface, see the [Data Validation documentation](https://docs.kadoa.com/docs/data-validation).

## Prerequisites

To get the most out of this guide, you'll need to:
- Create a Kadoa account
- Get your API key
- Have a completed workflow run with preview data

## Quick Start

Here's a complete example showing how to run an extraction, automatically generate validation rules, and get validation results:

```typescript
import { KadoaClient, pollUntil } from '@kadoa/node-sdk';

const client = new KadoaClient({
  apiKey: 'your-api-key',
  enableRealtime: true // For real-time monitoring, see [Notifications Guide](./NOTIFICATIONS_GUIDE)
});

// Run extraction with validation enabled
const result = await client.extraction.run({
  urls: ['https://sandbox.kadoa.com/ecommerce'],
  name: 'Product Extraction with Validation'
});

// Wait for AI to suggest validation rules
const rulesResult = await pollUntil(
  async () => {
    return await client.validation.rules.listRules({
      workflowId: result.workflowId,
      status: 'preview' // Only suggested rules
    });
  },
  (result) => result.data.length > 0,
  {
    pollIntervalMs: 1000,
    timeoutMs: 30000
  }
);

// Approve all suggested rules
const approvedRules = await client.validation.rules.bulkApproveRules({
  workflowId: result.workflowId,
  ruleIds: rulesResult.result.data.map(rule => rule.id)
});

// Schedule validation
const validation = await client.validation.schedule(
  result.workflowId,
  result.workflow?.jobId || ''
);

// Wait for validation to complete
const completedValidation = await client.validation.waitUntilCompleted(
  validation.validationId
);

// Get validation anomalies
const anomalies = await client.validation.getAnomalies(validation.validationId);
console.log('Validation completed with', anomalies.anomaliesByRule.length, 'rule violations');
```

## Validation Lifecycle

The validation process integrates seamlessly with your extraction workflows:

### 1. Automatic Rule Generation

After an extraction completes, Kadoa automatically analyzes your data and suggests validation rules:

```typescript
// Rules are generated automatically after extraction
// No action needed - just wait for suggestions
const suggestedRules = await client.validation.rules.listRules({
  workflowId: 'your-workflow-id',
  status: 'preview'
});
```

### 2. Rule Approval

Review and approve suggested rules before they become active:

```typescript
// List suggested rules
const rules = await client.validation.rules.listRules({
  workflowId: 'your-workflow-id',
  status: 'preview'
});

// Approve specific rules
await client.validation.rules.bulkApproveRules({
  workflowId: 'your-workflow-id',
  ruleIds: rules.data.map(rule => rule.id)
});

// Or approve individual rules
await client.validation.rules.updateRule(ruleId, {
  status: 'enabled'
});
```

### 3. Validation Execution

Schedule validation runs to check your data against active rules:

```typescript
// Schedule validation for a specific job
const validation = await client.validation.schedule(
  workflowId,
  jobId
);

// Wait for completion
const result = await client.validation.waitUntilCompleted(
  validation.validationId
);
```

## Working with Validation Results

### Getting Validation Details

```typescript
// Get specific validation details
const validation = await client.validation.getValidationDetails(validationId);

// Get latest validation for a workflow
const latest = await client.validation.getLatest(workflowId);

// Get latest validation for a specific job
const latestJob = await client.validation.getLatest(workflowId, jobId);
```

### Understanding Anomalies

Validation results include detailed anomaly information:

```typescript
// Get all anomalies for a validation
const anomalies = await client.validation.getAnomalies(validationId);

// Get anomalies for a specific rule
const ruleAnomalies = await client.validation.getAnomaliesByRule(
  validationId,
  'rule-name'
);

// Anomaly structure
console.log(anomalies.anomaliesByRule);
// [
//   {
//     ruleName: 'title_not_empty',
//     anomalies: [
//       {
//         id: 'anomaly-1',
//         rowId: 'row-123',
//         badValue: null,
//         column: 'title'
//       }
//     ]
//   }
// ]
```

### Validation History

List all validations for a workflow with pagination:

```typescript
const validations = await client.validation.listWorkflowValidations({
  workflowId: 'your-workflow-id',
  jobId: 'your-job-id',
  page: 1,
  pageSize: 20
});
```


## Getting Help

If you're stuck:
1. **Check the examples** in this documentation
2. **Browse the GitHub examples** in `/examples/node-examples/src/`
3. **Search GitHub Issues**
4. **Contact support** at support@kadoa.com

## Next Steps

- Learn about [Validation Rules Management](./VALIDATION_RULES_GUIDE) for advanced rule customization
- Explore [Schema Management](./SCHEMA_SDK_GUIDE) for defining data structures
- Check out [Real-time Notifications](./NOTIFICATIONS_GUIDE) for monitoring validation events
