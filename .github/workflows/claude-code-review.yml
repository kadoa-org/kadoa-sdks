name: Claude Code Review

on:
    pull_request:
        types: [opened, synchronize, reopened]
    # Allow manual triggers for re-running reviews
    workflow_dispatch:

permissions:
    contents: read
    pull-requests: write
    issues: write
    id-token: write

jobs:
    claude-review:
        name: Review PR with Claude
        runs-on: ubuntu-latest
        steps:
            - name: Checkout code
              uses: actions/checkout@v5
              with:
                  fetch-depth: 0

            - name: Claude Code Review
              uses: anthropics/claude-code-action@v1
              with:
                  anthropic_api_key: ${{ secrets.ANTHROPIC_API_KEY }}
                  # Use the /review command to analyze the PR
                  prompt: |
                      Please review this pull request focusing on:
                      - Code quality and adherence to the style guides in CLAUDE.md and STYLEGUIDE.md
                      - Conventional commit message format compliance
                      - ACL pattern compliance (no direct imports from generated/)
                      - Module boundary violations (runtime vs domains)
                      - Potential bugs or logic errors
                      - Test coverage for new features
                      - Documentation completeness
                  claude_args: "--max-turns 10 --model claude-sonnet-4"
